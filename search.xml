<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Webassembly-Introduce]]></title>
    <url>%2F2019%2F05%2F26%2FWebassembly-Introduce%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬çŸ¥é“ JavaScript æ˜¯ä¸€é—¨è„šæœ¬è¯­è¨€ï¼Œå…·æœ‰åŠ¨æ€ç±»åž‹å’Œçµæ´»çš„è¡¨è¾¾åŠ›ï¼Œæˆ‘ä»¬çŸ¥é“è„šæœ¬è¯­è¨€é€šå¸¸è¦è§£é‡Šè¿è¡Œï¼Œè¿™ä¹Ÿå°†è¦æ¶ˆè€—ä¸€äº›æ€§èƒ½å¼€é”€ï¼ŒäºŽæ˜¯ Google åœ¨ 2009 å¹´åœ¨ V8 ä¸­å¼•å…¥äº† JIT(Just in time compiling) æŠ€æœ¯ï¼ŒæŠŠ JavaScript è¿è¡Œæ—¶çš„æ€§èƒ½æŽ¨åˆ°äº†é¡¶å³°ï¼ŒåŒå¹´åˆ©ç”¨ V8 å¼•æ“Žè¯žç”Ÿäº† Node.jsï¼Œæ‰“å¼€äº†ä½¿ç”¨ JavaScript å†™åŽç«¯åº”ç”¨çš„å¤§é—¨ã€‚å¯¹äºŽç›®å‰å†™ç½‘ç»œåº”ç”¨è€Œè¨€ JavaScript å·²ç»è¶³å¤Ÿç”¨äº†ï¼ŒåŠ ä¸Š Google V8 å¼•æ“Žèƒ½å¸®æˆ‘ä»¬è§£å†³æŽ‰å¤§éƒ¨åˆ†é—®é¢˜ã€‚ä½†æ˜¯å½“æˆ‘ä»¬æŠŠ JavaScript åº”ç”¨åˆ°è¯¸å¦‚ 3D æ¸¸æˆã€è™šæ‹ŸçŽ°å®žã€å¢žå¼ºçŽ°å®žã€è®¡ç®—æœºè§†è§‰ã€å›¾åƒ/è§†é¢‘ç¼–è¾‘ä»¥åŠå¤§é‡çš„è¦æ±‚åŽŸç”Ÿæ€§èƒ½çš„å…¶ä»–é¢†åŸŸçš„æ—¶å€™ï¼Œå°±é‡åˆ°äº†æ€§èƒ½é—®é¢˜ï¼Œå°¤å…¶æ˜¯ç§»åŠ¨å¹³å°è¿›ä¸€æ­¥æ”¾å¤§äº†è¿™äº›æ€§èƒ½ç“¶é¢ˆã€‚ è€Œ WebAssembly çš„å‡ºçŽ°å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒæ˜¯ä¸€é—¨ä½Žçº§çš„ç±»æ±‡ç¼–è¯­è¨€ï¼Œå¯ä»¥è¿è¡Œåœ¨çŽ°ä»£ç½‘ç»œæµè§ˆå™¨ä¸­çš„æ–°åž‹ä»£ç å¹¶ä¸”æä¾›æ–°çš„æ€§èƒ½ç‰¹æ€§å’Œæ•ˆæžœã€‚å®ƒè®¾è®¡çš„ç›®çš„ä¸æ˜¯ä¸ºäº†æ‰‹å†™ä»£ç ï¼Œè€Œæ˜¯ä¸ºäº†è¯¸å¦‚ Cã€C++ å’Œ Rust ç­‰ä½Žçº§æºè¯­è¨€æä¾›ä¸€ä¸ªé«˜æ•ˆçš„ç¼–è¯‘ç›®æ ‡ä»¥ä¾¿å®ƒä»¬èƒ½å¤Ÿåœ¨ç½‘ç»œä¸Šè¿è¡Œã€‚å¯¹äºŽç½‘ç»œå¹³å°è€Œè¨€ï¼Œè¿™å…·æœ‰å·¨å¤§çš„æ„ä¹‰â€”â€”è¿™ä¸ºå®¢æˆ·ç«¯ app æä¾›äº†ä¸€ç§åœ¨ç½‘ç»œå¹³å°ä»¥æŽ¥è¿‘æœ¬åœ°é€Ÿåº¦çš„æ–¹å¼è¿è¡Œå¤šç§è¯­è¨€ç¼–å†™ä»£ç çš„æ–¹å¼ï¼›åœ¨è¿™ä¹‹å‰ï¼Œå®¢æˆ·ç«¯ app æ˜¯ä¸å¯èƒ½åšåˆ°çš„ã€‚ æ–‡ä»¶æ ¼å¼ä¸Žç”ŸæˆWebAssembly æœ‰äºŒè¿›åˆ¶ (.wasm) å’Œæ–‡æœ¬ (.wast) ä¸¤ç§æ ¼å¼ï¼Œå¹¶ä¸”ä¸¤ç§æ ¼å¼å¯ä»¥äº’äº«è½¬æ¢ï¼Œåœ¨ä¼ è¾“å’Œè¿è¡Œæ—¶ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œè€Œæ–‡æœ¬æ ¼å¼æ˜¯ä¸ºäº†é˜…è¯»å’Œå¼€å‘è°ƒè¯•æ‰€ä½¿ç”¨ã€‚ ä»¥ C ä¸ºä¾‹ï¼Œé¦–å…ˆæŠŠ C ç¨‹åºç¼–è¯‘ä¸º WebAssembly æ ¼å¼ï¼Œæœ¬åœ°ç¼–è¯‘å¯ä»¥æŸ¥çœ‹ ç¼–è¯‘ C/C++ ä¸º WebAssembly æ–‡ç« è¿›è¡Œç›¸å…³è½¯ä»¶çš„å®‰è£…ï¼Œä¸ºäº†æ–¹ä¾¿å¯ä»¥ç›´æŽ¥ä½¿ç”¨è¿™æ¬¾åœ¨çº¿å·¥å…·è¿›è¡Œè½¬æ¢ WasmFiddle æˆ‘ä»¬å…ˆæ¥ä¸ªç®€å•çš„ï¼Œåœ¨ main ä¸­è¿”å›žä¸€ä¸ªæ•°å­—ï¼Œåœ¨ add æ–¹æ³•ä¸­æ±‚å’Œ:1234567int main() &#123; return 42;&#125;int add(int a, int b) &#123; return a + b;&#125; è½¬æ¢è¿‡åŽçš„ .wast æ–‡æœ¬æ ¼å¼ä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ä»Žè¿™ä¸ªæ–‡æœ¬çœ‹å‡ºåˆ†åˆ« export äº† main ä¸Ž add æ–¹æ³•12345678910111213141516(module (table 0 anyfunc) (memory $0 1) (export "memory" (memory $0)) (export "main" (func $main)) (export "add" (func $add)) (func $main (; 0 ;) (result i32) (i32.const 42) ) (func $add (; 1 ;) (param $0 i32) (param $1 i32) (result i32) (i32.add (get_local $1) (get_local $0) ) )) å¯¼å…¥å¹¶åˆå§‹åŒ–ä½¿ç”¨ Fetch èŽ·å–æ¨¡å—å¹¶åˆå§‹åŒ–è°ƒç”¨:12345678fetch('module.wasm') .then(response =&gt; response.arrayBuffer()) .then(bytes =&gt; WebAssembly.instantiate(bytes)) .then(results =&gt; &#123; console.log(typeof results.instance.exports.main); // function console.log(results.instance.exports.main()); // 42 console.log(results.instance.exports.add(1, 2)); // 3 &#125;) ä½¿ç”¨ XMLHttpRequest èŽ·å–æ¨¡å—å¹¶åˆå§‹åŒ–è°ƒç”¨:123456789101112131415const request = new XMLHttpRequest();request.open('GET', 'module.wasm');request.responseType = 'arraybuffer';request.onload = function() &#123; var bytes = request.response; WebAssembly .instantiate(bytes) .then(results =&gt; &#123; console.log(typeof results.instance.exports.main); console.log(results.instance.exports.main()); console.log(results.instance.exports.add(1, 2)); &#125;);&#125;;request.send(); å¯ä»¥ç•…æƒ³ä¸‹ä»¥åŽ WebAssembly æ™®åŠçš„è¯ï¼Œåˆ°æ—¶æˆ‘ä»¬ç”¨çš„ Reactã€Vueã€Angular å¯èƒ½å°±æ˜¯ç”¨ C/C++ æˆ–è€…å…¶ä»–åº•å±‚è¯­è¨€å†™çš„ã€‚]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
      </categories>
      <tags>
        <tag>webassembly</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JS-Event-Loop]]></title>
    <url>%2F2019%2F05%2F26%2FJS-Event-Loop%2F</url>
    <content type="text"><![CDATA[äº‹ä»¶å¾ªçŽ¯çš„é¡ºåºï¼Œå†³å®šäº† JavaScript ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚å®ƒä»Ž script (æ•´ä½“ä»£ç ) å¼€å§‹ç¬¬ä¸€æ¬¡å¾ªçŽ¯ã€‚ä¹‹åŽå…¨å±€ä¸Šä¸‹æ–‡è¿›å…¥å‡½æ•°è°ƒç”¨æ ˆã€‚ç›´åˆ°è°ƒç”¨æ ˆæ¸…ç©º(åªå‰©å…¨å±€)ï¼Œç„¶åŽæ‰§è¡Œæ‰€æœ‰çš„ Micro Taskã€‚å½“æ‰€æœ‰å¯æ‰§è¡Œçš„ Micro Task æ‰§è¡Œå®Œæ¯•ä¹‹åŽã€‚å¾ªçŽ¯å†æ¬¡ä»Ž Macro Task å¼€å§‹ï¼Œæ‰¾åˆ°å…¶ä¸­ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæ¯•ï¼Œç„¶åŽå†æ‰§è¡Œæ‰€æœ‰çš„ Micro Taskï¼Œåœ¨æ‰§è¡Œ Micro Taskã€Macro Task çš„æ—¶å€™åŒæ ·éµå¾ª Event Loop åŽŸåˆ™ï¼Œå°±è¿™æ ·ä¸€ç›´å¾ªçŽ¯ä¸‹åŽ»ã€‚ åœ¨è®¨è®º Micro Taskã€Macro Task ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œåˆ†æžä»¥ä¸‹ä»£ç å¹¶æ€è€ƒ log æ‰“çš„å°é¡ºåº ç¤ºä¾‹ä»£ç  123456789101112131415console.log('script start');setTimeout(() =&gt; &#123; console.log('setTimeout 1');&#125;);Promise.resolve().then(() =&gt; &#123; console.log('promise 1');&#125;).then(() =&gt; &#123; console.log('promise 2');&#125;);console.log('script end'); è¿è¡Œç»“æžœä¸ºï¼š 12345script startscript endpromise 1promise 2setTimeout 1 å…ˆæ˜Žç™½å‡ ä¸ªæ¦‚å¿µ Event LoopEvent Loopï¼šäº‹ä»¶å¾ªçŽ¯ æˆ‘ä»¬çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹è¯­è¨€ï¼Œä¸€å¿ƒä¸èƒ½äºŒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½æŠŠä¸€ä»¶äº‹å¹²å®Œæ‰èƒ½åŽ»å¹²å¦ä¸€ä»¶äº‹ï¼Œä½†å‰ç«¯çš„ä¸€äº›ä»»åŠ¡æ˜¯éžå¸¸è€—æ—¶çš„ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œå®šæ—¶å™¨å’Œäº‹ä»¶ç›‘å¬ï¼Œå¦‚æžœè®©å®ƒä»¬å’Œåˆ«çš„ä»»åŠ¡ä¸€æ ·ï¼Œéƒ½è€è€å®žå®žçš„æŽ’é˜Ÿç­‰å¾…æ‰§è¡Œçš„è¯ï¼Œæ‰§è¡Œæ•ˆçŽ‡ä¼šéžå¸¸çš„ä½Žï¼Œç”šè‡³å¯¼è‡´é¡µé¢çš„å‡æ­»ã€‚æ‰€ä»¥ä¸ºäº†ä¿è¯ä½¿ç”¨æµç•…ï¼Œæµè§ˆå™¨é‡‡ç”¨äº† Event Loop äº‹ä»¶å¾ªçŽ¯ç³»ç»Ÿæ¥ç®¡ç†ï¼ŒæŠŠé‚£äº›è€—æ—¶çš„ä»»åŠ¡æ”¾å…¥ task queues æ ˆä¸­ï¼Œç­‰ä¸»ç¨‹åºæ‰§è¡Œå®Œå†æ‰§è¡Œ task queues ä¸­çš„ä»»åŠ¡ï¼Œé€šå¸¸ä½¿ç”¨å›žè°ƒå‡½æ•°ç›‘å¬ task queues ä¸­çš„ä»»åŠ¡çŠ¶æ€ã€‚ åœ¨å…¶å®ƒè¯­è¨€ä¸­å¯ä»¥è¿Ÿå»¶æ‰§è¡Œï¼Œæ¯”å¦‚ C è¯­è¨€çš„ sleep(3) å¯ä»¥è¿Ÿå»¶ 3 ç§’æ‰§è¡ŒåŽè¾¹çš„é€»è¾‘ï¼Œä½†æ˜¯åœ¨ JavaScript ä¸­æ˜¯æ²¡æœ‰è¿™æ ·çš„æ“ä½œï¼ˆé™¤äº† alertã€confrimã€prompt å’Œå¼‚æ­¥ xhrï¼Œå®˜æ–¹è¯´è¿™äº›æ˜¯åŽ†å²é—ç•™çš„é”™è¯¯è®¾è®¡ðŸ˜‚ï¼‰ï¼Œåªèƒ½ä½¿ç”¨å¼‚æ­¥æ–¹å¼åŽ»æ¨¡æ‹Ÿï¼Œæ¨¡æ‹Ÿçš„å®žé™…ä¹Ÿä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ sleep æ•ˆæžœã€‚ Micro Taskã€Macro Taskæƒ³è¦æžæ˜Žç™½è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆè¦äº†è§£ Event Loop ä¸‹çš„ Micro Task å’Œ Macro Taskï¼Œåœ¨è¿è¡Œä¸»ç¨‹åºæ—¶ä¼šæŠŠå¼‚æ­¥é€»è¾‘æ ¹æ®æƒ…å†µæŽ¨åˆ° Micro Task æˆ–è€… Macro Task æ ˆä¸­ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ ä»¥ä¸‹æƒ…å†µä¼šæŽ¨åˆ° Micro Task æ ˆä¸­ cess.nextTick mise ect.observe ationObserver ä¸‹æƒ…å†µä¼šæŽ¨åˆ° Macro Task æ ˆä¸­ setTimeout setInterval setImmediate I/O UI render ç„¶åŽå†æ¥çœ‹å®žä¾‹ä»£ç çš„å®žé™…æ‰§è¡Œé€»è¾‘ æ‰§è¡Œ console.log(â€˜script startâ€™) ç›´æŽ¥è¾“å‡º æ‰§è¡Œ setTimeout æŠŠå›žè°ƒå‡½æ•°æ”¾å…¥ Macro Task æ ˆä¸­ æ‰§è¡Œ Promise æŠŠä¸¤ä¸ª then çš„å›žè°ƒå‡½æ•°æ”¾å…¥ Micro Task æ ˆä¸­ æ‰§è¡Œ console.log(â€˜script endâ€™) ç›´æŽ¥è¾“å‡º æ‰§è¡Œ Micro Task ä¸­æ‰€æœ‰ä»»åŠ¡ i. æ‰§è¡Œ console.log(â€˜promise 1â€™) ç›´æŽ¥è¾“å‡º ii. æ‰§è¡Œ console.log(â€˜promise 2â€™) ç›´æŽ¥è¾“å‡º æ‰§è¡Œ Macro Task ä¸­æ‰€æœ‰ä»»åŠ¡ æ‰§è¡Œ console.log(â€˜setTimeout 1â€™) ç›´æŽ¥è¾“å‡º]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
</search>
