<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Webassembly-Rust]]></title>
    <url>%2F2019%2F06%2F10%2FWebassembly-Rust%2F</url>
    <content type="text"><![CDATA[ä¸Šä¸€ç¯‡æ–‡ç« æœ‰ç®€å•ä»‹ç»Webassemblyæ ¼å¼, ä»¥åŠåˆ©ç”¨åœ¨çº¿è½¬åŒ–å·¥å…·æŠŠCä»£ç ç¼–è¾‘åˆ°Webassembly. è¿™ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ç»§ç»­æŽ¢è®¨å¦‚ä½•å°†Rustè¯­è¨€æºä»£ç ç¼–è¯‘åˆ°Webassemblyå¹¶åœ¨è°·æ­Œæµè§ˆå™¨ä¸­è¿è¡Œã€‚Rustæ˜¯ç«ç‹å…¬å¸å¼€å‘å‡ºæ¥çš„ä¸€æ¬¾é™æ€ç¼–è¯‘åž‹è¯­è¨€, Rustè¯­è¨€çš„è¯¦ç»†ä»‹ç»å¯ä»¥çœ‹å®˜ç½‘. ä¹‹å‰ä¾‹å­åœ¨å®žé™…é¡¹ç›®ä¸­çš„åº”ç”¨è¿˜è¦å¾ˆå¤šå·¥ä½œè¦åšï¼Œæ¯”å¦‚å¦‚ä½•åœ¨Cä¸­è°ƒç”¨æµè§ˆå™¨çŽ¯å¢ƒä¸­çš„APIï¼ŒJSå¼•æ“Žçš„æ•°æ®ç»“æž„å¦‚ä½•ä¼ é€’åˆ°Cä¸­ç­‰ç­‰ï¼Œç›¸è¾ƒäºŽä¹‹å‰ä»‹ç»Cè¯­è¨€ç¼–è¯‘åˆ°Webassemblyå¹¶åœ¨æµè§ˆå™¨è¿è¡Œçš„ç®€å•å°è¯•ï¼ŒRustç¤¾åŒºä¸€ç›´ç§¯æžçš„æŽ¨åŠ¨WebassemblyäºŽwebç«¯å®žé™…åº”ç”¨ï¼Œå¹¶å¼€å‘å‡ºä¸€ç³»åˆ—å·¥å…·ä¸Žç±»åº“ã€‚ å®‰è£… Rust çŽ¯å¢ƒå®‰è£…Rustå‰å¾€ Install Rust é¡µé¢å¹¶è·ŸéšæŒ‡ç¤ºå®‰è£… Rustã€‚è¿™é‡Œä¼šå®‰è£…ä¸€ä¸ªåä¸º â€œrustupâ€ çš„å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·èƒ½è®©ä½ ç®¡ç†å¤šä¸ªä¸åŒç‰ˆæœ¬çš„ Rustã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šå®‰è£…ç”¨äºŽæƒ¯å¸¸Rustå¼€å‘çš„ stable ç‰ˆæœ¬ Rust Releaseã€‚Rustup ä¼šå®‰è£… Rust çš„ç¼–è¯‘å™¨ rustcã€Rust çš„åŒ…ç®¡ç†å·¥å…· cargoã€Rust çš„æ ‡å‡†åº“ rust-std ä»¥åŠä¸€äº›æœ‰ç”¨çš„æ–‡æ¡£ rust-docsã€‚ å®‰è£…wasm-packè¦å°†Rustæ¨¡å—æž„å»ºä¸ºå‰ç«¯npmåŒ…ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¢å¤–å·¥å…· wasm-packã€‚å®ƒä¼šå¸®åŠ©æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„ä»£ç ç¼–è¯‘æˆ WebAssembly å¹¶åˆ¶é€ å‡ºæ­£ç¡®çš„ npm åŒ…ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥ä¸‹è½½å¹¶å®‰è£…å®ƒï¼š1$ cargo install wasm-pack æž„å»ºæˆ‘ä»¬çš„ WebAssembly npm åŒ…åˆ›å»ºä¸€ä¸ªæ–°çš„ Rust åŒ…ã€‚æ‰“å¼€ä½ ç”¨æ¥å­˜æ”¾ä½ ç§äººé¡¹ç›®çš„ç›®å½•ï¼Œåšè¿™äº›äº‹ï¼š12$ cargo new --lib wasm-test Created library `wasm-test` project è¿™é‡Œä¼šåœ¨åä¸º wasm-test çš„å­ç›®å½•é‡Œåˆ›å»ºä¸€ä¸ªæ–°çš„åº“ï¼Œé‡Œé¢æœ‰ä¸‹ä¸€æ­¥ä¹‹å‰ä½ æ‰€éœ€è¦çš„ä¸€åˆ‡ï¼š123+-- Cargo.toml+-- src +-- lib.rs è¿™é‡Œæœ‰ä¸€ä¸ª Cargo.toml æ–‡ä»¶ï¼Œè¿™æ˜¯æˆ‘ä»¬é…ç½®æž„å»ºçš„æ–¹å¼ã€‚å¦‚æžœä½ ç”¨è¿‡ npm çš„ package.jsonï¼Œä½ åº”è¯¥ä¼šæ„Ÿåˆ°å¾ˆç†Ÿæ‚‰ã€‚Cargo çš„ç”¨æ³•å’Œå®ƒä»¬ç±»ä¼¼ã€‚æŽ¥ä¸‹æ¥ï¼ŒCargo åœ¨ src/lib.rs ç”Ÿæˆäº†ä¸€äº› Rust ä»£ç ï¼š æ¥å†™ç‚¹ Rust ä»£ç åœ¨ src/lib.rs å†™ä¸€äº›ä»£ç æ›¿æ¢æŽ‰åŽŸæ¥çš„ï¼š123456789101112131415161718192021extern crate wasm_bindgen; // ç”³æ˜Žå¤–éƒ¨ä¾èµ–åº“use wasm_bindgen::prelude::*; // å¯¼å…¥å¤–éƒ¨ä¾èµ–åº“/* åœ¨ #[] ä¸­çš„å†…å®¹å«åš "å±žæ€§"ï¼Œå¹¶ä»¥æŸç§æ–¹å¼æ”¹å˜ä¸‹é¢çš„è¯­å¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸‹é¢çš„è¯­å¥æ˜¯ä¸€ä¸ª externï¼Œå®ƒå°†å‘Šè¯‰ Rust æˆ‘ä»¬æƒ³è°ƒç”¨ä¸€äº›å¤–éƒ¨å®šä¹‰çš„å‡½æ•°ã€‚è¿™ä¸ªå±žæ€§ wasm-bindgen å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•æ‰¾åˆ°è¿™äº›å‡½æ•° */#[wasm_bindgen]extern &#123; pub fn alert(s: &amp;str);&#125;/* æˆ‘ä»¬åˆçœ‹åˆ°äº† #[wasm_bindgen] å±žæ€§ã€‚åœ¨è¿™é‡Œï¼Œå®ƒå¹¶éžå®šä¹‰ä¸€ä¸ª extern å—ï¼Œè€Œæ˜¯ fnï¼Œè¿™ä»£è¡¨æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨ JavaScript ä¸­ä½¿ç”¨è¿™ä¸ª Rust å‡½æ•°ã€‚ è¿™å’Œ extern æ­£ç›¸åï¼šæˆ‘ä»¬å¹¶éžå¼•å…¥å‡½æ•°ï¼Œè€Œæ˜¯è¦æŠŠå‡½æ•°ç»™å¤–éƒ¨ä¸–ç•Œä½¿ç”¨ã€‚ */#[wasm_bindgen]pub fn greet(name: &amp;str) &#123; alert(&amp;format!("Hello, &#123;&#125;!", name));&#125; æŠŠæˆ‘ä»¬çš„ä»£ç ç¼–è¯‘åˆ° WebAssemblyä¸ºäº†èƒ½å¤Ÿæ­£ç¡®çš„ç¼–è¯‘æˆ‘ä»¬çš„ä»£ç ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦é…ç½® Cargo.tomlã€‚æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå°†å†…å®¹æ”¹ä¸ºå¦‚ä¸‹æ‰€ç¤º:12345678910111213[package]name = &quot;wasm-test&quot;version = &quot;0.1.0&quot;authors = [&quot;Your Name &lt;you@example.com&gt;&quot;]description = &quot;A sample project with wasm-pack&quot;license = &quot;MIT/Apache-2.0&quot;repository = &quot;https://github.com/yourgithubusername/wasm-test&quot;[lib]crate-type = [&quot;cdylib&quot;][dependencies]wasm-bindgen = &quot;0.2&quot; æœ€é‡è¦çš„æ˜¯æ·»åŠ åº•ä¸‹çš„éƒ¨åˆ†ã€‚ç¬¬ä¸€ä¸ªéƒ¨åˆ† â€” [lib] â€” å‘Šè¯‰ Rust ä¸ºæˆ‘ä»¬çš„åŒ…å»ºç«‹ä¸€ä¸ª cdylib[dependencies] éƒ¨åˆ†ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å‘Šè¯‰ Cargo æˆ‘ä»¬éœ€è¦ä¾èµ–å“ªä¸ªç‰ˆæœ¬çš„ wasm-bindgen æž„å»ºNPMåŒ…Rustæºä»£ç å®Œæˆï¼Œä¾èµ–é…ç½®ä¹Ÿè®¾ç½®å¥½äº†ï¼Œå‡†å¤‡æž„å»ºNPMå‰ç«¯æ¨¡å—ï¼1$ wasm-pack build wasm-pack build ä¼šè¿›è¡Œå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š æŠŠRustä»£ç ç¼–è¯‘ä¸º WebAssembly. åœ¨ç”Ÿæˆçš„ WebAssemblyæ–‡ä»¶æ‰§è¡Œ wasm-bindgen , ç”Ÿæˆä¸€ä¸ªnpmèƒ½è¯†åˆ«JSæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—åŒ…å«åˆšç”ŸæˆWebAssemblyæ–‡ä»¶. ç”Ÿæˆä¸€ä¸ª pkg æ–‡ä»¶å¤¹ï¼Œå¹¶æŠŠç”Ÿæˆçš„JSæ¨¡å—ä¸ŽWebAssemblyæ–‡ä»¶ç§»å…¥. è¯»å– Cargo.toml å¹¶ç”Ÿæˆå¯¹åº”çš„ package.json. æ‹·è´ README.mdï¼ˆå¦‚æžœæœ‰çš„è¯ï¼‰åˆ° pkgæ–‡ä»¶å¤¹. åœ¨ç½‘ç«™ä¸Šä½¿ç”¨åˆšç”Ÿæˆçš„åŒ…æ–°å»ºä¸€ä¸ªå‰ç«¯æ–‡ä»¶å¤¹siteï¼Œå¹¶è¿è¡Œï¼š1$ npm init -y ç¼–è¯‘package.json12345678910&#123; "scripts": &#123; "serve": "webpack-dev-server" &#125;, "devDependencies": &#123; "webpack": "^4.25.1", "webpack-cli": "^3.1.2", "webpack-dev-server": "^3.1.10" &#125;&#125; æ–°å»ºä¸€ä¸ªwebpack.config.jsæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š123456789const path = require('path');module.exports = &#123; entry: "./index.js", output: &#123; path: path.resolve(__dirname, "dist"), filename: "index.js", &#125;, mode: "development"&#125;; æ–°å»ºä¸€ä¸ªindex.htmlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š12345678910&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;hello-wasm example&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;script src="./index.js"&gt;&lt;/script&gt; &lt;/body&gt;&lt;/html&gt; æ–°å»ºä¸€ä¸ªindex.jsæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š1234const js = import("./pkg/wasm-test.js");js.then(js =&gt; &#123; js.greet("WebAssembly");&#125;); æ‰“å¼€æŽ§åˆ¶å°ï¼Œè¿è¡Œï¼š12$ npm install$ npm run serve æ‰“å¼€è°·æ­Œæµè§ˆå™¨ï¼Œè®¿é—®http://localhost:8080 åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªalertå¼¹çª—ã€‚]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
      </categories>
      <tags>
        <tag>webassembly, rust</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Webassembly-Introduce]]></title>
    <url>%2F2019%2F05%2F26%2FWebassembly-Introduce%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬çŸ¥é“ JavaScript æ˜¯ä¸€é—¨è„šæœ¬è¯­è¨€ï¼Œå…·æœ‰åŠ¨æ€ç±»åž‹å’Œçµæ´»çš„è¡¨è¾¾åŠ›ï¼Œæˆ‘ä»¬çŸ¥é“è„šæœ¬è¯­è¨€é€šå¸¸è¦è§£é‡Šè¿è¡Œï¼Œè¿™ä¹Ÿå°†è¦æ¶ˆè€—ä¸€äº›æ€§èƒ½å¼€é”€ï¼ŒäºŽæ˜¯ Google åœ¨ 2009 å¹´åœ¨ V8 ä¸­å¼•å…¥äº† JIT(Just in time compiling) æŠ€æœ¯ï¼ŒæŠŠ JavaScript è¿è¡Œæ—¶çš„æ€§èƒ½æŽ¨åˆ°äº†é¡¶å³°ï¼ŒåŒå¹´åˆ©ç”¨ V8 å¼•æ“Žè¯žç”Ÿäº† Node.jsï¼Œæ‰“å¼€äº†ä½¿ç”¨ JavaScript å†™åŽç«¯åº”ç”¨çš„å¤§é—¨ã€‚å¯¹äºŽç›®å‰å†™ç½‘ç»œåº”ç”¨è€Œè¨€ JavaScript å·²ç»è¶³å¤Ÿç”¨äº†ï¼ŒåŠ ä¸Š Google V8 å¼•æ“Žèƒ½å¸®æˆ‘ä»¬è§£å†³æŽ‰å¤§éƒ¨åˆ†é—®é¢˜ã€‚ä½†æ˜¯å½“æˆ‘ä»¬æŠŠ JavaScript åº”ç”¨åˆ°è¯¸å¦‚ 3D æ¸¸æˆã€è™šæ‹ŸçŽ°å®žã€å¢žå¼ºçŽ°å®žã€è®¡ç®—æœºè§†è§‰ã€å›¾åƒ/è§†é¢‘ç¼–è¾‘ä»¥åŠå¤§é‡çš„è¦æ±‚åŽŸç”Ÿæ€§èƒ½çš„å…¶ä»–é¢†åŸŸçš„æ—¶å€™ï¼Œå°±é‡åˆ°äº†æ€§èƒ½é—®é¢˜ï¼Œå°¤å…¶æ˜¯ç§»åŠ¨å¹³å°è¿›ä¸€æ­¥æ”¾å¤§äº†è¿™äº›æ€§èƒ½ç“¶é¢ˆã€‚ è€Œ WebAssembly çš„å‡ºçŽ°å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒæ˜¯ä¸€é—¨ä½Žçº§çš„ç±»æ±‡ç¼–è¯­è¨€ï¼Œå¯ä»¥è¿è¡Œåœ¨çŽ°ä»£ç½‘ç»œæµè§ˆå™¨ä¸­çš„æ–°åž‹ä»£ç å¹¶ä¸”æä¾›æ–°çš„æ€§èƒ½ç‰¹æ€§å’Œæ•ˆæžœã€‚å®ƒè®¾è®¡çš„ç›®çš„ä¸æ˜¯ä¸ºäº†æ‰‹å†™ä»£ç ï¼Œè€Œæ˜¯ä¸ºäº†è¯¸å¦‚ Cã€C++ å’Œ Rust ç­‰ä½Žçº§æºè¯­è¨€æä¾›ä¸€ä¸ªé«˜æ•ˆçš„ç¼–è¯‘ç›®æ ‡ä»¥ä¾¿å®ƒä»¬èƒ½å¤Ÿåœ¨ç½‘ç»œä¸Šè¿è¡Œã€‚å¯¹äºŽç½‘ç»œå¹³å°è€Œè¨€ï¼Œè¿™å…·æœ‰å·¨å¤§çš„æ„ä¹‰â€”â€”è¿™ä¸ºå®¢æˆ·ç«¯ app æä¾›äº†ä¸€ç§åœ¨ç½‘ç»œå¹³å°ä»¥æŽ¥è¿‘æœ¬åœ°é€Ÿåº¦çš„æ–¹å¼è¿è¡Œå¤šç§è¯­è¨€ç¼–å†™ä»£ç çš„æ–¹å¼ï¼›åœ¨è¿™ä¹‹å‰ï¼Œå®¢æˆ·ç«¯ app æ˜¯ä¸å¯èƒ½åšåˆ°çš„ã€‚ æ–‡ä»¶æ ¼å¼ä¸Žç”ŸæˆWebAssembly æœ‰äºŒè¿›åˆ¶ (.wasm) å’Œæ–‡æœ¬ (.wast) ä¸¤ç§æ ¼å¼ï¼Œå¹¶ä¸”ä¸¤ç§æ ¼å¼å¯ä»¥äº’äº«è½¬æ¢ï¼Œåœ¨ä¼ è¾“å’Œè¿è¡Œæ—¶ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œè€Œæ–‡æœ¬æ ¼å¼æ˜¯ä¸ºäº†é˜…è¯»å’Œå¼€å‘è°ƒè¯•æ‰€ä½¿ç”¨ã€‚ ä»¥ C ä¸ºä¾‹ï¼Œé¦–å…ˆæŠŠ C ç¨‹åºç¼–è¯‘ä¸º WebAssembly æ ¼å¼ï¼Œæœ¬åœ°ç¼–è¯‘å¯ä»¥æŸ¥çœ‹ ç¼–è¯‘ C/C++ ä¸º WebAssembly æ–‡ç« è¿›è¡Œç›¸å…³è½¯ä»¶çš„å®‰è£…ï¼Œä¸ºäº†æ–¹ä¾¿å¯ä»¥ç›´æŽ¥ä½¿ç”¨è¿™æ¬¾åœ¨çº¿å·¥å…·è¿›è¡Œè½¬æ¢ WasmFiddle æˆ‘ä»¬å…ˆæ¥ä¸ªç®€å•çš„ï¼Œåœ¨ main ä¸­è¿”å›žä¸€ä¸ªæ•°å­—ï¼Œåœ¨ add æ–¹æ³•ä¸­æ±‚å’Œ:1234567int main() &#123; return 42;&#125;int add(int a, int b) &#123; return a + b;&#125; è½¬æ¢è¿‡åŽçš„ .wast æ–‡æœ¬æ ¼å¼ä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ä»Žè¿™ä¸ªæ–‡æœ¬çœ‹å‡ºåˆ†åˆ« export äº† main ä¸Ž add æ–¹æ³•12345678910111213141516(module (table 0 anyfunc) (memory $0 1) (export "memory" (memory $0)) (export "main" (func $main)) (export "add" (func $add)) (func $main (; 0 ;) (result i32) (i32.const 42) ) (func $add (; 1 ;) (param $0 i32) (param $1 i32) (result i32) (i32.add (get_local $1) (get_local $0) ) )) å¯¼å…¥å¹¶åˆå§‹åŒ–ä½¿ç”¨ Fetch èŽ·å–æ¨¡å—å¹¶åˆå§‹åŒ–è°ƒç”¨:12345678fetch('module.wasm') .then(response =&gt; response.arrayBuffer()) .then(bytes =&gt; WebAssembly.instantiate(bytes)) .then(results =&gt; &#123; console.log(typeof results.instance.exports.main); // function console.log(results.instance.exports.main()); // 42 console.log(results.instance.exports.add(1, 2)); // 3 &#125;) ä½¿ç”¨ XMLHttpRequest èŽ·å–æ¨¡å—å¹¶åˆå§‹åŒ–è°ƒç”¨:123456789101112131415const request = new XMLHttpRequest();request.open('GET', 'module.wasm');request.responseType = 'arraybuffer';request.onload = function() &#123; var bytes = request.response; WebAssembly .instantiate(bytes) .then(results =&gt; &#123; console.log(typeof results.instance.exports.main); console.log(results.instance.exports.main()); console.log(results.instance.exports.add(1, 2)); &#125;);&#125;;request.send(); å¯ä»¥ç•…æƒ³ä¸‹ä»¥åŽ WebAssembly æ™®åŠçš„è¯ï¼Œåˆ°æ—¶æˆ‘ä»¬ç”¨çš„ Reactã€Vueã€Angular å¯èƒ½å°±æ˜¯ç”¨ C/C++ æˆ–è€…å…¶ä»–åº•å±‚è¯­è¨€å†™çš„ã€‚]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
      </categories>
      <tags>
        <tag>webassembly</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JS-Event-Loop]]></title>
    <url>%2F2019%2F05%2F26%2FJS-Event-Loop%2F</url>
    <content type="text"><![CDATA[äº‹ä»¶å¾ªçŽ¯çš„é¡ºåºï¼Œå†³å®šäº† JavaScript ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚å®ƒä»Ž script (æ•´ä½“ä»£ç ) å¼€å§‹ç¬¬ä¸€æ¬¡å¾ªçŽ¯ã€‚ä¹‹åŽå…¨å±€ä¸Šä¸‹æ–‡è¿›å…¥å‡½æ•°è°ƒç”¨æ ˆã€‚ç›´åˆ°è°ƒç”¨æ ˆæ¸…ç©º(åªå‰©å…¨å±€)ï¼Œç„¶åŽæ‰§è¡Œæ‰€æœ‰çš„ Micro Taskã€‚å½“æ‰€æœ‰å¯æ‰§è¡Œçš„ Micro Task æ‰§è¡Œå®Œæ¯•ä¹‹åŽã€‚å¾ªçŽ¯å†æ¬¡ä»Ž Macro Task å¼€å§‹ï¼Œæ‰¾åˆ°å…¶ä¸­ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæ¯•ï¼Œç„¶åŽå†æ‰§è¡Œæ‰€æœ‰çš„ Micro Taskï¼Œåœ¨æ‰§è¡Œ Micro Taskã€Macro Task çš„æ—¶å€™åŒæ ·éµå¾ª Event Loop åŽŸåˆ™ï¼Œå°±è¿™æ ·ä¸€ç›´å¾ªçŽ¯ä¸‹åŽ»ã€‚ åœ¨è®¨è®º Micro Taskã€Macro Task ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œåˆ†æžä»¥ä¸‹ä»£ç å¹¶æ€è€ƒ log æ‰“çš„å°é¡ºåº ç¤ºä¾‹ä»£ç  123456789101112131415console.log('script start');setTimeout(() =&gt; &#123; console.log('setTimeout 1');&#125;);Promise.resolve().then(() =&gt; &#123; console.log('promise 1');&#125;).then(() =&gt; &#123; console.log('promise 2');&#125;);console.log('script end'); è¿è¡Œç»“æžœä¸ºï¼š 12345script startscript endpromise 1promise 2setTimeout 1 å…ˆæ˜Žç™½å‡ ä¸ªæ¦‚å¿µ Event LoopEvent Loopï¼šäº‹ä»¶å¾ªçŽ¯ æˆ‘ä»¬çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹è¯­è¨€ï¼Œä¸€å¿ƒä¸èƒ½äºŒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½æŠŠä¸€ä»¶äº‹å¹²å®Œæ‰èƒ½åŽ»å¹²å¦ä¸€ä»¶äº‹ï¼Œä½†å‰ç«¯çš„ä¸€äº›ä»»åŠ¡æ˜¯éžå¸¸è€—æ—¶çš„ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œå®šæ—¶å™¨å’Œäº‹ä»¶ç›‘å¬ï¼Œå¦‚æžœè®©å®ƒä»¬å’Œåˆ«çš„ä»»åŠ¡ä¸€æ ·ï¼Œéƒ½è€è€å®žå®žçš„æŽ’é˜Ÿç­‰å¾…æ‰§è¡Œçš„è¯ï¼Œæ‰§è¡Œæ•ˆçŽ‡ä¼šéžå¸¸çš„ä½Žï¼Œç”šè‡³å¯¼è‡´é¡µé¢çš„å‡æ­»ã€‚æ‰€ä»¥ä¸ºäº†ä¿è¯ä½¿ç”¨æµç•…ï¼Œæµè§ˆå™¨é‡‡ç”¨äº† Event Loop äº‹ä»¶å¾ªçŽ¯ç³»ç»Ÿæ¥ç®¡ç†ï¼ŒæŠŠé‚£äº›è€—æ—¶çš„ä»»åŠ¡æ”¾å…¥ task queues æ ˆä¸­ï¼Œç­‰ä¸»ç¨‹åºæ‰§è¡Œå®Œå†æ‰§è¡Œ task queues ä¸­çš„ä»»åŠ¡ï¼Œé€šå¸¸ä½¿ç”¨å›žè°ƒå‡½æ•°ç›‘å¬ task queues ä¸­çš„ä»»åŠ¡çŠ¶æ€ã€‚ åœ¨å…¶å®ƒè¯­è¨€ä¸­å¯ä»¥è¿Ÿå»¶æ‰§è¡Œï¼Œæ¯”å¦‚ C è¯­è¨€çš„ sleep(3) å¯ä»¥è¿Ÿå»¶ 3 ç§’æ‰§è¡ŒåŽè¾¹çš„é€»è¾‘ï¼Œä½†æ˜¯åœ¨ JavaScript ä¸­æ˜¯æ²¡æœ‰è¿™æ ·çš„æ“ä½œï¼ˆé™¤äº† alertã€confrimã€prompt å’Œå¼‚æ­¥ xhrï¼Œå®˜æ–¹è¯´è¿™äº›æ˜¯åŽ†å²é—ç•™çš„é”™è¯¯è®¾è®¡ðŸ˜‚ï¼‰ï¼Œåªèƒ½ä½¿ç”¨å¼‚æ­¥æ–¹å¼åŽ»æ¨¡æ‹Ÿï¼Œæ¨¡æ‹Ÿçš„å®žé™…ä¹Ÿä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ sleep æ•ˆæžœã€‚ Micro Taskã€Macro Taskæƒ³è¦æžæ˜Žç™½è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆè¦äº†è§£ Event Loop ä¸‹çš„ Micro Task å’Œ Macro Taskï¼Œåœ¨è¿è¡Œä¸»ç¨‹åºæ—¶ä¼šæŠŠå¼‚æ­¥é€»è¾‘æ ¹æ®æƒ…å†µæŽ¨åˆ° Micro Task æˆ–è€… Macro Task æ ˆä¸­ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ ä»¥ä¸‹æƒ…å†µä¼šæŽ¨åˆ° Micro Task æ ˆä¸­ cess.nextTick mise ect.observe ationObserver ä¸‹æƒ…å†µä¼šæŽ¨åˆ° Macro Task æ ˆä¸­ setTimeout setInterval setImmediate I/O UI render ç„¶åŽå†æ¥çœ‹å®žä¾‹ä»£ç çš„å®žé™…æ‰§è¡Œé€»è¾‘ æ‰§è¡Œ console.log(â€˜script startâ€™) ç›´æŽ¥è¾“å‡º æ‰§è¡Œ setTimeout æŠŠå›žè°ƒå‡½æ•°æ”¾å…¥ Macro Task æ ˆä¸­ æ‰§è¡Œ Promise æŠŠä¸¤ä¸ª then çš„å›žè°ƒå‡½æ•°æ”¾å…¥ Micro Task æ ˆä¸­ æ‰§è¡Œ console.log(â€˜script endâ€™) ç›´æŽ¥è¾“å‡º æ‰§è¡Œ Micro Task ä¸­æ‰€æœ‰ä»»åŠ¡ i. æ‰§è¡Œ console.log(â€˜promise 1â€™) ç›´æŽ¥è¾“å‡º ii. æ‰§è¡Œ console.log(â€˜promise 2â€™) ç›´æŽ¥è¾“å‡º æ‰§è¡Œ Macro Task ä¸­æ‰€æœ‰ä»»åŠ¡ æ‰§è¡Œ console.log(â€˜setTimeout 1â€™) ç›´æŽ¥è¾“å‡º]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
</search>
